<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/main.html}">
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>Gestion des utilisateurs</title>
<script th:src="@{/js/app_ng.js}"></script>
</head>
<body data-ng-app="Cperf" data-ng-controller="AdminCtrl">
	<div class="container-fluid" layout:fragment="content" data-ng-init="getUsers();">
		<!-- chargement du fragment du modal qui affiche les process d'un utilisateur -->
		<div th:replace="fragments/userProcessModal::userProcessModal"></div>
		<!-- Page Heading -->
		<div th:replace="fragments/main_content_heading::heading(heading_text='Gestion des comptes utilisateurs')"></div>
		<!-- content -->
			<div class="class row">
				<div class="col-sm-12">
				<!-- Modal default user photo editor-->
					<div class="modal fade" id="modaldefaultUserPhoto" tabindex="-1" role="dialog" aria-labelledby="modaldefaultUserPhoto" aria-hidden="true">
					  <div class="modal-dialog" role="document">
					    <div class="modal-content">
					      <div class="modal-header">
					        <h5 class="modal-title" id="exampleModalLabel">Photo d'utilisateur par défault</h5>
					        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					          <span aria-hidden="true">&times;</span>
					        </button>
					      </div>
					      <div class="modal-body text-center insc_avatar">
							 <img alt="" th:src="@{/User/getDefaultUserPhoto}" class="circle w-50"/>
					      </div>
					      <div class="modal-footer">
					       	<form th:action="@{/Admin/User/changeDefaultPhoto}" method="post" enctype="multipart/form-data" class="form-control border-0 mshz-form-validate">
					       		<div class="form-group">
				       				<input type="file" name="photo" class="float-left w-75 img_field_trigger" accept="image/*"  data-mshz-required="true"/>
				       				<button type="submit" class="btn btn-sm btn-outline-info float-right w-25">Valider</button>
					       		</div>
					       	</form>
					      </div>
					    </div>
					  </div>
					</div>
				<!-- End Modal default user photo editor-->
					<div class="card border-0 p-0 bg-transparent">
						<div class="card-body p-0 bg-info">
							<table class="table table-sm table-bordered mt-3 bg-light">
								<thead class="text-info text-uppercase text-center">
								<tr>
									<td colspan="30">
										
							<!--=========== row de control ================-->
							<div class="row ml-1 mr-1">
								<div class="col-sm-6 col-md-3 form-group text-left">
								    <button type="button" class="btn btn-sm btn-outline-info" data-toggle="modal" data-target="#modaldefaultUserPhoto">
									<img alt="" th:src="@{/User/getDefaultUserPhoto}" class="circle" style="width:40px; height:40px;"/>
									<div><small>Photo d'utilisateur par default</small></div>
									</button>
								</div>
								<div class="d-none d-md-block col-md-2 form-group">
									<label class="control-label"><small>Max lignes/page :</small></label> <input type="number" min="1"
										data-ng-model="size"
										class="form-control form-control-sm"
										data-ng-change="getUsers();"/>
								</div>
								<div class="d-none d-md-block col-md-2 form-group">
									<label class="control-label"><small>Trier par :</small></label>
									<select data-ng-model="orderField"
										class="form-control form-control-sm">
										<option value="firstname">Prénom</option>
										<option value="lastname">Nom</option>
										<option value="fonction">Fonction</option>
										<option value="group">Groupe</option>
										<option value="role">Profile</option>
										<option value="valid">Status</option>
									</select>
								</div>
								<div class="d-none d-md-block col-md-2 form-group">
									<label class="control-label"><small>Ordre :</small></label> <select
										data-ng-model="orderFieldReverse"
										class="form-control form-control-sm">
										<option value="-" selected="selected">Déscendant</option>
										<option value="+">Ascendant</option>
									</select>
								</div>
								<!-- <div class="col-sm-6 col-md-3 form-group">
									<label class="control-label"><small>Rubrique de
											recherche :</small></label> <select data-ng-model="$parent.searchRubField"
										class="form-control form-control-sm">
										<option value="num" selected="selected">Numéro de
											dossier</option>
										<option value="client">Client</option>
										<option value="numBl">Numéro BL</option>
										<option value="navire">Navire ou vol</option>
										<option value="declaration">Numéro déclaration</option>
									</select>
								</div> -->
								<div class="col-sm-6 col-md-3  form-group">
									<label class="control-label"><small>Rechercher :</small></label> <input type="text"
										data-ng-model="$parent.searchField"
										class="form-control form-control-sm"
										placeholder="Rechercher par nom ou prénom..."
										data-ng-change="getUsers();" />
								</div>
							</div>
							<!-- ========== end row de control =====-->
									</td>
								</tr>
									<tr>
										<th>Photo & Profil</th>
										<th>Prénom & Nom</th>
										<th>Fonction</th>
										<th>Superieur hierachique</th>
										<th>Groupe</th><th>Rôles</th>
										<th>Process & tâches</th>
										<th class="text-center">Status</th>
									</tr>
								</thead>
								<tbody class="text-center">
									<tr data-ng-if="users.content.length>0"
										data-ng-repeat="user in users.content | orderBy:orderFieldReverse+orderField">
										<td>
											<img alt="" th:src="@{/User/getUserPhoto?uid={{user.id}}}" class="circle" style="max-height:50px;max-height:50px;">
											<a th:href="@{/User/Profile/?uid={{user.id}}}">
												<i class="fas fa-user-tag border-0 border-left pl-3 cursor-pointer text-primary" title="Profil infos"></i>
											</a>
										</td>
										<td>{{reoplaceWithNullOrBlank(user.firstname,"Non renseigné") + ' '+reoplaceWithNullOrBlank(user.lastname,"")}}</td>
										<td>{{reoplaceWithNullOrBlank(user.fonction.name,"Non rensignée")}}</td>
										<td data-ng-if="user.userSup != null">{{reoplaceWithNullOrBlank(user.userSup.lastname,"Non renseigné") + ' '+reoplaceWithNullOrBlank(user.userSup.lastname,"")}}</td>
										<td data-ng-if="user.userSup == null">Sans supérieur hierarchique</td>
										<td>
											<small data-ng-repeat="group in user.groupes">{{group.name}}
											<small data-ng-if="group.role != null" class="text-info font-weight-bold">({{group.role.role}})</small>&nbsp;;&nbsp;</small>
											<span data-ng-if="user.groupes.length<=0">Sans groupe</span>
										</td>
										<td>
											<small data-ng-repeat="role in user.roles">{{role.role}}&nbsp;;&nbsp;</small>
											<span data-ng-if="user.roles.length<=0">Sans role</span>
											<a th:href="@{/Admin/User/Edit/?uid={{user.id}}}" title="Modifier" class="float-right">
												<i class="fas fa-pen-alt" style="font-size:13px;"></i>
											</a>
										</td>
										<td class="text-center">
											<i class="fa fa-eye fa-lg cursor-pointer text-primary" title="Afficher les process" data-ng-click="getUserProcess(user.id)"></i>
										</td>
										<td class="text-center">
										<a href="#"
											class="text-decoration-none mr-3" title="Débloquer"
											data-ng-if="!user.valid" data-userId="{{user.id}}"
											data-status="true" data-ng-click="chageUserStatus($event)">
												<small class="mr-1 pr-1 border-right text-danger">Bloqué</small>
												<i
												class="fas fa-key fa_table_link text-success p-1"
												data-userId="{{user.id}}" data-status="true"
												data-ng-click="chageUserStatus($event)"></i>
										</a>
										<a data-ng-if="!user.valid" th:href="@{/Admin/User/del?uid={{user.id}}}" title="Supprimer"
										     class="text-decoration-none mr-3" onclick="showconfirmDialog(event, this);"
										     data-dialogConfirmTitle="Attention" data-dialogConfirmBody="Souhaitez-vous vraiment supprimer cet utilisateur ?">
											 <i class="fas fa-trash-alt fa_table_link text-danger p-1 dialogShower"></i>
										</a>
										 <a href="#" class="text-decoration-none mr-3"
											data-ng-if="user.valid" title="bloquer"
											data-userId="{{user.id}}" data-status="false"
											data-ng-click="chageUserStatus($event)">
												<small class="mr-1 pr-1 border-right text-success">Active</small>
												 <i
												class="fas fa-user-lock fa_table_link text-danger p-1"
												data-userId="{{user.id}}" data-status="false"
												data-ng-click="chageUserStatus($event)"></i>
										</a>
										</td>
									</tr>
									<tr data-ng-if="users.content.length<=0">
										<td colspan="30"  class="text-center">
											<h5>Zéro utilisateur trouvé !</h5>
										</td>
									</tr>
								</tbody>
							</table>
							<!-- =========== PAGINATION ============= -->
							<nav aria-label="..." data-ng-if="pages.length>0" class="">
								<ul class="pagination float-right" style="margin:-12px 1px 3px 1px;">
									<!--<li class="page-item" data-ng-if="{pages.length-$parent.page>1}">
										<a class="page-link" href="#" tabindex="-1">Previous</a>
									</li> -->
								   <li data-ng-repeat="p in pages" class="page-item" 
								   	     data-ng-class="{'active': $parent.page==p}">
								   		<button  type="button" class="page-link" data-pageIndex="{{p}}" 
								   		data-ng-click="changePage($event)">{{p+1}}</button>
								   </li>
								   <!-- <li class="page-item"><a class="page-link" data-ng-if="false">Next</a></li> -->
								</ul>
							</nav>
							<!-- ================ AND PAGINATION -->
						</div>
					</div>
				</div>
			</div>
		<!-- content -->
	</div>
	<div layout:fragment="addon-scripts-content">
		<script th:src="@{/js/main.js}"></script>
	</div>
</body>
</html>
